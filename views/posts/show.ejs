<% layout('layouts/boilerplate') %>

<div class="container py-2 mx-width mx-auto bg-light px-3 rounded mb-2">
  <div class="card-body d-flex gap-3 py-2">
    <div>
      <img
        src="https://d33wubrfki0l68.cloudfront.net/fb0ba0cbcadbdf0b2ffabf331d2345fb05106e16/20663/images/profile-picture.webp"
        alt=""
        class="rounded-circle profile-image"
      />
    </div>
    <form action="/posts/<%= post._id %>/comments" method="POST" class="w-100">
      <div class="d-flex">
        <input
          type="text"
          name="comment[text]"
          class="form-control btn-custom"
          placeholder="Add a comment..."
          required
        />
        <div class="valid-feedback">Looks good!</div>
        <button class="btn btn-outline-primary btn-opc btn-custom pe-3">
          Post
        </button>
      </div>
    </form>
  </div>
</div>

<div class="card mb-3 mx-width mx-auto">
  <% if(post.caption){ %>
  <div class="card-body pb-0">
    <div class="d-flex gap-3">
      <div>
        <img
          src="https://d33wubrfki0l68.cloudfront.net/fb0ba0cbcadbdf0b2ffabf331d2345fb05106e16/20663/images/profile-picture.webp"
          alt=""
          class="rounded-circle profile-image"
        />
      </div>
      <div>
        <span class="fs-7"><b><%= post.user.username %></b> <%=post.caption %></span>
        <div class="d-flex align-items-center gap-1 mt-1">
          <span class="text-muted fs-8">Edited</span>
          <span class="text-muted fs-8">&#183</span>
          <span class="text-muted fs-8">10m</span>
        </div>
      </div>
    </div>
  </div>
  <hr />
  <% } %>
  <% for (comment of post.comments){ %>
  <div class="card-body">
    <div class="d-flex gap-3">
      <div>
        <img
          src="https://d33wubrfki0l68.cloudfront.net/fb0ba0cbcadbdf0b2ffabf331d2345fb05106e16/20663/images/profile-picture.webp"
          alt=""
          class="rounded-circle profile-image"
        />
      </div>
      <div>
        <span class="fs-7 mb-0"><b>anas_ahmad35 </b> <%= comment.text %></span>
        <div class="d-flex align-items-center gap-2">
          <span class="text-muted fs-8">10m</span>
          <span class="text-muted fs-8 bold fw-semibold">100 likes</span>
          <span class="text-muted fs-8 fw-semibold">Reply</span>
          <span class="text-muted fs-8"
            >      <!-- Button trigger modal -->
            <button
              type="button"
              class="btn ms-auto btn-custom py-0"
              data-bs-toggle="modal"
              data-bs-target="#comment<%= comment._id %>"
            >
              <i class="fa-solid fa-ellipsis fs-6"></i>
            </button>
            </span>
        </div>
      </div>
    </div>
  </div>
  <!-- Modal -->
<div
class="modal fade"
id="comment<%= comment._id %>"
tabindex="-1"
aria-labelledby="<%= comment._id %>Label"
aria-hidden="true"
>
<div class="modal-dialog modal-sm modal-dialog-centered">
  <div class="modal-content">
    <div class="modal-body text-center border-bottom">
      <form action="/posts/<%= post._id %>/comments/<%= comment._id %>?_method=DELETE" method="POST">
        <button class="btn btn-outline-danger btn-delete btn-custom py-0 ms-auto">Delete</button>
      </form>
    </div>
    <div class="modal-footer text-center">
      <button
        type="button"
        class="btn btn-custom py-0 mx-auto"
        data-bs-dismiss="modal"
      >
        Close
      </button>
    </div>
  </div>
</div>
</div>
  <% } %>
</div>

<a href="/posts/<%= post._id %>/edit">Edit</a>
<form action="/posts/<%= post._id %>?_method=DELETE" method="POST">
  <button class="btn btn-outline-danger my-3">Delete</button>
</form>